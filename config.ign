{"ignition":{"version":"3.5.0"},"passwd":{"users":[{"name":"core","passwordHash":"$BUTANE_PASSWORD_HASH"}]},"storage":{"directories":[{"path":"/etc/ucore-autorebase","mode":492}],"disks":[{"device":"/dev/sdb","partitions":[{"label":"bios-1","sizeMiB":1,"typeGuid":"21686148-6449-6E6F-744E-656564454649"},{"label":"esp-1","sizeMiB":127,"typeGuid":"C12A7328-F81F-11D2-BA4B-00A0C93EC93B"},{"label":"boot-1","sizeMiB":384},{"label":"root-1"}],"wipeTable":true},{"device":"/dev/sdc","partitions":[{"label":"bios-2","sizeMiB":1,"typeGuid":"21686148-6449-6E6F-744E-656564454649"},{"label":"esp-2","sizeMiB":127,"typeGuid":"C12A7328-F81F-11D2-BA4B-00A0C93EC93B"},{"label":"boot-2","sizeMiB":384},{"label":"root-2"}],"wipeTable":true},{"device":"/dev/sdd","partitions":[{"label":"storageraid.1.1","number":1}],"wipeTable":true},{"device":"/dev/sde","partitions":[{"label":"storageraid.1.2","number":1}],"wipeTable":true}],"files":[{"path":"/etc/hostname","contents":{"compression":"","source":"data:,alphonse"},"mode":420}],"filesystems":[{"device":"/dev/disk/by-partlabel/esp-1","format":"vfat","label":"esp-1","wipeFilesystem":true},{"device":"/dev/disk/by-partlabel/esp-2","format":"vfat","label":"esp-2","wipeFilesystem":true},{"device":"/dev/md/md-boot","format":"ext4","label":"boot","wipeFilesystem":true},{"device":"/dev/md/md-root","format":"xfs","label":"root","wipeFilesystem":true},{"device":"/dev/md/storage","format":"btrfs","label":"storage","path":"/var/storage"}],"raid":[{"devices":["/dev/disk/by-partlabel/boot-1","/dev/disk/by-partlabel/boot-2"],"level":"raid1","name":"md-boot","options":["--metadata=1.0"]},{"devices":["/dev/disk/by-partlabel/root-1","/dev/disk/by-partlabel/root-2"],"level":"raid1","name":"md-root"},{"devices":["/dev/disk/by-partlabel/storageraid.1.1","/dev/disk/by-partlabel/storageraid.1.2"],"level":"raid1","name":"storage"}]},"systemd":{"units":[{"contents":"# Generated by Butane\n[Unit]\nRequires=systemd-fsck@dev-md-storage.service\nAfter=systemd-fsck@dev-md-storage.service\n\n[Mount]\nWhere=/var/storage\nWhat=/dev/md/storage\nType=btrfs\n\n[Install]\nRequiredBy=local-fs.target","enabled":true,"name":"var-storage.mount"},{"contents":"[Unit]\nDescription=uCore autorebase to unsigned OCI and reboot\nConditionPathExists=!/etc/ucore-autorebase/unverified\nConditionPathExists=!/etc/ucore-autorebase/signed\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nExecStart=/usr/bin/rpm-ostree rebase --bypass-driver ostree-unverified-registry:ghcr.io/ublue-os/ucore:stable\nExecStart=/usr/bin/touch /etc/ucore-autorebase/unverified\nExecStart=/usr/bin/systemctl disable ucore-unsigned-autorebase.service\nExecStart=/usr/bin/systemctl reboot\n[Install]\nWantedBy=multi-user.target\n","enabled":false,"name":"ucore-unsigned-autorebase.service"},{"contents":"[Unit]\nDescription=uCore autorebase to signed OCI and reboot\nConditionPathExists=/etc/ucore-autorebase/unverified\nConditionPathExists=!/etc/ucore-autorebase/signed\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nExecStart=/usr/bin/rpm-ostree rebase --bypass-driver ostree-image-signed:docker://ghcr.io/ublue-os/ucore:stable\nExecStart=/usr/bin/touch /etc/ucore-autorebase/signed\nExecStart=/usr/bin/systemctl disable ucore-signed-autorebase.service\nExecStart=/usr/bin/systemctl reboot\n[Install]\nWantedBy=multi-user.target\n","enabled":false,"name":"ucore-signed-autorebase.service"},{"contents":"[Unit]\nDescription=Start and login to tailscale on uCore rebased system\nConditionPathExists=/etc/ucore-autorebase/unverified\nConditionPathExists=/etc/ucore-autorebase/signed\nConditionPathExist=!/etc/ucore-autorebase/setup-tailscale\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nStandardOutput=journal+console\nExecStart=/usr/bin/systemctl enable --now tailscaled.service\nExecStart=/usr/bin/tailscale up --accept-routes --ssh --auth-key=$BUTANE_TS_AUTH_KEY\nExecStart=/usr/bin/systemctl disable ucore-enable-tailscale.service\nExecStart=/usr/bin/touch /etc/ucore-autorebase/setup-tailscale\n[Install]\nWantedBy=multi-user.target\n","enabled":false,"name":"ucore-setup-tailscale.service"}]}}
